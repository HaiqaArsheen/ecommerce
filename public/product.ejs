<!-- views/product.ejs -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= product.name %></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="../assests/style.css">

</head>
<body>
      <!--- SECTION 1 THE UPPER BAR -->
      <nav class="navbar bg-body-tertiary top">
        <div class="container-fluid">
            <div class="header ms-5 ps-5">
            <i class="bi bi-telephone"><a>03070879467</a></i>
            <i class="bi bi-envelope"><a>haiqaarsheen2@gmail.com</a></i>
            </div>
          <form class="d-flex  me-5 ms-auto login">
            <li class=" dropdown ">
                <a class="nav-link dropdown-toggle " href="#" role="button" data-bs-toggle="dropdown">
                  US
                </a>
                <ul class="dropdown-menu">
                  <li><a class="dropdown-item" href="#">PK</a></li>
                  
                </ul>
              </li> 
              <i class="bi bi-person mt-4"><a href="login.html">LOGIN</a></i>          </form>
        </div>
      </nav>
      <!--SECTION 2 THE NAVBAR-->
    <nav class="navbar navbar-expand-lg  fixed  ">
        <div class="container-fluid">
         <img class="ms-5 ps-5 navbar-brand" src="../img/home/logo.png">
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav  ms-auto  mb-2 mb-lg-0">
              <li class="nav-item">
                <a class="nav-link  color" aria-current="page" href="index.html">HOME</a>
              </li>
              
              <li class="nav-item dropdown ">
                <a class="nav-link dropdown-toggle color" href="#" role="button" data-bs-toggle="dropdown">
                  CATEGORIES
                </a>
                <ul class="dropdown-menu">
                  <li><a class="dropdown-item" href="#">Statement Rings</a></li>
                  <li><a class="dropdown-item" href="#">Wired Wrapped jewellery</a></li>
                  <li><a class="dropdown-item" href="#">Loos Gemstones</a></li>
                  <li><a class="dropdown-item" href="#">Brands</a></li>
                  <li><a class="dropdown-item" href="#">Pendant</a></li>
                  <li><a class="dropdown-item" href="#">Braclets</a></li>
                  <li><a class="dropdown-item" href="#">Earrings</a></li>
                </ul>
              </li>
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="products.html">PRODUCTS</a>
              </li>
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="FAQ.html">FAQ</a>
              </li>
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="contact.html">CONTACT</a>
              </li>
            </ul>
            <form class="d-flex manuicon me-5 ms-auto ">
                <i class="bi bi-heart "></i>  
                <i class="bi bi-search"></i>             
                <i class="bi bi-cart3"></i> 
                <div class="badge">0</div>
              </form>
          </div>
        </div>
      </nav>

      <div class="container mt-5 product-details">
        <div class="row">
            <div class="col-md-6">
                <div id="productImagesCarousel" class="carousel slide" data-ride="carousel">
                    <div class="carousel-inner">
                        <div class="carousel-item active">
                            <img src="<%= product.image1 %>" class="d-block w-100" alt="Product Image 1">
                        </div>
                        <div class="carousel-item">
                            <img src="<%= product.image2 %>" class="d-block w-100" alt="Product Image 2">
                        </div>
                        <div class="carousel-item">
                            <img src="<%= product.image3 %>" class="d-block w-100" alt="Product Image 3">
                        </div>
                    </div>
                    <a class="carousel-control-prev" href="#productImagesCarousel" role="button" data-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#productImagesCarousel" role="button" data-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </a>
                </div>
            </div>
            <div class="col-md-6">
                <h1><%= product.name %></h1>
                <p class="price">$<%= product.price %></p>
                <p class="description"><%= product.description %></p>
                <button id="add-to-cart-btn" class="add-to-cart-btn btn btn-primary">ADD TO CART</button>

            </div>
        </div>

        <button  class=" btn btn-primary"> <a href="http://localhost:3000/"  style="text-decoration: none; color: white;"> Back</a></button>

    </div>



    <!--- SECTION 11 THE 1 ROW AND THREE COLUMN -->
<div class="row me-0 rowfirst pt-5 mt-3">
    <div class="column colfirst col-md-4 col-12  ">
      <h2 class="ps-5">CUSTOMER SERVICES</h2>
      <ul>
        <a href="login.html"><li>Login</li></a>
        <a href="registration.html"><li>Registration</li></a>
        <a href="contact.html"><li>Contact</li></a>
        <a href="cookiespolicy.html"><li>Cookies Policy</li></a>
  
      </ul>
    </div>
    <div class="column colfirst col-md-4 col-12 ">
      <h2>MEHTAB JEWELLERS</h2>
      <h4> Address: </h4>
      <p>New Sarafa Bazar , Zaman Market , Rawalpindi | Safa Gold Mall Ground Floor, F-7 Jinnah Super Market, Islamabad, Pakistan
  
        .</p>
        <h4>Hotline:<span> 03155364953</span></h4>
        <h4>Email: <span>mehtab.jewellers@gmail.com</span></h4>
    </div>
    <div class="column colfirst col-md-4 col-12">
      <h2>SUBSCRIBE & RECEIVE 10% OFF YOUR FIRST ORDER</h2>
      
    <div class="input">  <input type="email" placeholder="Enter your email"></div>
      <h4 class="mt-4">CONNECT WITH US</h4>
      <div class="social-icons">
        <!-- Add social media icons here -->
        <i class="bi bi-facebook"></i>
        <i class="bi bi-instagram"></i>
        <i class="bi bi-tiktok"></i>    </div>
    </div>
  </div>
  <!---SECTION 12 LAST SECTION -->
  <div class="lastnav">
  <div class="navbar fixed-bottom lastnav ">
    <div class="container-fluid">
      <p class="navbar-brand" >Your experience on this site will be improved by allowing cookies<span> Cookie Policy</span> </p>
      <a href="#"><button>ALLOW COOKIES</button></a>
    </div>
  </div>
  </div>
  
  <!----DESIGN CART -->
  <div class="cart" id="cart" >
   
    <span id="close-cart" class="close-icon">&times;</span>
    <h2>Shopping Cart</h2>
    <div class="cart-items" id="cart-items"></div>
    <p> Sub Total: <span id="total" >$0</span></p>
    <button id="checkout-btn">Checkout</button>
    <button id="view-cart-btn" >View Cart</button>
  
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" ></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const addToCartButtons = document.querySelectorAll('.add-to-cart-btn');
  const cart = document.getElementById('cart');
  const cartItems = document.getElementById('cart-items');
  const total = document.getElementById('total');
  const closeButton = document.getElementById('close-cart');
  const checkoutButton = document.getElementById('checkout-btn');
  const viewCartButton = document.getElementById('view-cart-btn');
  const badge = document.querySelector('.badge');

  let totalPrice = 0;
  let cartCount = 0;

  function loadCartData() {
    const savedCartItems = localStorage.getItem('cartItems');
    const savedTotalPrice = localStorage.getItem('totalPrice');
    const savedCartCount = localStorage.getItem('cartCount');

    if (savedCartItems) {
      cartItems.innerHTML = savedCartItems.trim();
      totalPrice = parseFloat(savedTotalPrice) || 0;
      cartCount = parseInt(savedCartCount) || 0;
      total.innerText = `$${totalPrice.toFixed(2)}`;
      badge.textContent = cartCount;
      updateCartDisplay();
    }
  }

  function saveCartData() {
    localStorage.setItem('cartItems', cartItems.innerHTML.trim());
    localStorage.setItem('totalPrice', totalPrice);
    localStorage.setItem('cartCount', cartCount);
  }

  loadCartData();
  cart.style.display = 'none';

  addToCartButtons.forEach(button => {
    button.addEventListener('click', function() {
      const item = this.closest('.product-details');
      const itemNameElement = item.querySelector('h1');
      const itemPriceElement = item.querySelector('.price');
      const itemImageElement = item.querySelector('.carousel-item.active img');

      if (!itemNameElement || !itemPriceElement || !itemImageElement) {
        console.error('Missing item details.');
        return;
      }

      const itemName = itemNameElement.innerText;
      const itemPrice = parseFloat(itemPriceElement.innerText.replace('$', ''));
      const itemImage = itemImageElement.src;

      let existingCartItem = null;

      // Check if item already exists in cart
      cartItems.childNodes.forEach(node => {
        if (node.nodeType === Node.ELEMENT_NODE) {
          const name = node.querySelector('h4').innerText;
          if (name === itemName) {
            existingCartItem = node;
          }
        }
      });

      if (existingCartItem) {
        const quantityElement = existingCartItem.querySelector('.quantity');
        let quantity = parseInt(quantityElement.textContent) + 1;
        quantityElement.textContent = quantity;
        const priceElement = existingCartItem.querySelector('.price');
        if (priceElement) {
            const itemTotalPrice = itemPrice * quantity;
            priceElement.textContent = `$${itemTotalPrice.toFixed(2)}`;
          }
        totalPrice += itemPrice;
      } else {
        const cartItem = document.createElement('div');
        cartItem.classList.add('cart-item');
        cartItem.innerHTML = `
          <span class="remove-item">&times;</span>
          <div style="display: flex; align-items: center;">
            <img src="${itemImage}" alt="${itemName}" style="width: 60px; height: 60px;">
            <div style="margin-left: 5px;">
              <h4>${itemName}</h4>
              <p class="price">$${itemPrice.toFixed(2)}</p>
              quantity: <button class="quantity-btn minus-btn">-</button>
              <span class="quantity">1</span>
              <button class="quantity-btn plus-btn">+</button>
            </div>
          </div>
        `;
        cartItems.appendChild(cartItem);
        totalPrice += itemPrice;
        cartCount++;
      }

      total.innerText = `$${totalPrice.toFixed(2)}`;
      badge.textContent = cartCount;
      updateCartDisplay();
      saveCartData();
    });
  });

  cartItems.addEventListener('click', function(event) {
    if (event.target.classList.contains('remove-item')) {
        const cartItem = event.target.parentElement;
      const quantityElement = cartItem.querySelector('.quantity');
      const priceElement = cartItem.querySelector('.price');
      if (quantityElement && priceElement) {
        const itemTotalPrice = parseFloat(priceElement.textContent.replace('$', ''));
        totalPrice -= itemTotalPrice;
        total.innerText = `$${totalPrice.toFixed(2)}`;
        cartCount -= parseInt(quantityElement.textContent);

        cartCount = Math.max(cartCount, 0);

        badge.textContent = cartCount;
        cartItem.remove();
        saveCartData();
        updateCartDisplay();
      }
    } else if (event.target.classList.contains('plus-btn')) {
        const quantityElement = event.target.parentElement.querySelector('.quantity');
      let quantity = parseInt(quantityElement.textContent);
      quantity++;
      quantityElement.textContent = quantity;

      const priceElement = event.target.parentElement.parentElement.querySelector('.price');
      if (priceElement) {
        const itemPrice = parseFloat(priceElement.textContent.replace('$', ''));
        totalPrice += itemPrice;
        total.innerText = `$${totalPrice.toFixed(2)}`;
      }
      updateCartDisplay();
      saveCartData();
    } else if (event.target.classList.contains('minus-btn')) {
        const quantityElement = event.target.parentElement.querySelector('.quantity');
      let quantity = parseInt(quantityElement.textContent);
      if (quantity > 1) {
        quantity--;
        quantityElement.textContent = quantity;

        const priceElement = event.target.parentElement.parentElement.querySelector('.price');
        if (priceElement) {
          const itemPrice = parseFloat(priceElement.textContent.replace('$', ''));
          totalPrice -= itemPrice;
          total.innerText = `$${totalPrice.toFixed(2)}`;
        }
      }
    }
    updateCartDisplay();
    saveCartData();
  });

  closeButton.addEventListener('click', function() {
    cart.style.display = 'none';
  });

  viewCartButton.addEventListener('click', function() {
    window.location.href = 'viewcart.html';
  });

  checkoutButton.addEventListener('click', function() {
    window.location.href = '/index';
  });

  badge.addEventListener('click', function() {
    cart.style.display = (cart.style.display === 'block') ? 'none' : 'block';
  });

  function updateCartDisplay() {
    const nodes = [...cartItems.childNodes];
    nodes.forEach(node => {
      if (node.nodeType === Node.TEXT_NODE && !node.textContent.trim()) {
        node.remove();
      }
    });

    if (cartItems.children.length === 0) {
      cart.style.display = 'none';
      total.innerText = "$0.00";
      totalPrice = 0;
    } else {
      cart.style.display = 'block';
    }
  }
});
</script>
</body>
</html>
